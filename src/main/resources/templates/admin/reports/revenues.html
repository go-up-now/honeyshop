<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{/admin/layout/layout::layout(~{::title}, ~{::#main}, ~{::#jquery})}">

<head>
    <meta charset="UTF-8">
    <title>Doanh thu</title>

</head>

<body>
<div id="main">
    <!-- DataTales Example -->
    <div class="card shadow mb-4">
        <div class="card-header d-flex">
            <div class="col-md-12">
                <h3 class="m-0 font-weight-bold text-primary">Thống kê doanh thu</h3>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead>
                    <tr>
                        <th>STT</th>
                        <th>Khách hàng</th>
                        <th>Tên sản phẩm</th>
                        <th>Số lượng</th>
                        <th>Đơn giá</th>
                        <th>Doanh thu</th>
                        <th>Thời gian</th>
                    </tr>
                    </thead>
                    <tbody id="tableRevenue">
                    <!-- Dữ liệu sẽ được thêm vào đây bởi JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card-footer">
            <div class="total-price" style="text-align: left;">
                <p><strong>Tổng doanh thu: <span id="totalPrice">0 đ</span></strong>
                </p>
            </div>
        </div>
    </div>
</div>

<div id="jquery">
    <script>
        $(document).ready(function() {
            loadRevenueData(); // Gọi hàm khi tài liệu đã sẵn sàng

            function loadRevenueData() {
                $.ajax({
                    url: '/honeyshop/api/report',
                    method: 'GET',
                    success: function (data) {
                        var tableRows = '';
                        var totalRevenue = 0;
                        $.each(data, function (index, item) {
                            tableRows += '<tr>' +
                                '<td>' + (index + 1) + '</td>' +
                                '<td>' + item.userFullName + '</td>' +
                                '<td>' + item.productName + '</td>' +
                                '<td>' + item.quantity + '</td>' +
                                '<td>' + formatCurrency(item.price) + '</td>' +
                                '<td>' + formatCurrency(item.revenue) + '</td>' +
                                '<td>' + formatDate(item.day) + '</td>' +
                                '</tr>';
                            totalRevenue += item.revenue;
                        });
                        $('#tableRevenue').html(tableRows);
                        $('#totalPrice').text(formatCurrency(totalRevenue));
                    },
                    error: function () {
                        console.error('Lỗi khi tải dữ liệu doanh thu');
                    }
                });
            }

            // Hàm định dạng tiền tệ
            function formatCurrency(amount) {
                if (amount === null || amount === undefined) {
                    return '0 đ';
                }
                return amount.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
            }

            // Hàm định dạng ngày tháng
            function formatDate(dateString) {
                const options = { year: 'numeric', month: '2-digit', day: '2-digit' };
                return new Date(dateString).toLocaleDateString('vi-VN', options);
            }
        });
    </script>
</div>
</body>
</html>
